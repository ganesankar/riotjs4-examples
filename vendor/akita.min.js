!function(t,e){if("function"==typeof define&&define.amd)define("@datorama/akita",["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var n={exports:{}};e(n.exports),t.datoramaAkita=n.exports}}(this,function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.QueryConfig=function(t){return function(e){e[_n]={};for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];e[_n][i]=t[i]}}},t.StoreConfig=function(t){return function(e){e[Re]={idKey:"id"};for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];"name"===i?e[Re].storeName=t[i]:e[Re][i]=t[i]}}},t.action=Oe,t.addEntities=an,t.akitaConfig=function(t){He=i({},He,t)},t.akitaDevtools=function(t,e){void 0===e&&(e={});if(en)return;if(!window.__REDUX_DEVTOOLS_EXTENSION__)return;Qn.length&&Qn.forEach(function(t){return t.unsubscribe()}),t&&t.run||((t=t||{}).run=function(t){return t()},e=t);var n=Object.assign({},{name:"Akita",shallow:!0},e),r=window.__REDUX_DEVTOOLS_EXTENSION__.connect(n),o={};Qn.push(Ye.subscribe(function(t){var e;o=i({},o,((e={})[t]=nn[t]._value(),e)),r.send({type:"["+$n(t)+"] - @@INIT"},o)})),Qn.push(Qe.subscribe(function(t){delete o[t],r.send({type:"["+t+"] - Delete Store"},o)})),Qn.push(Le.subscribe(function(t){var n,s=_e.type,u=_e.entityIds,a=_e.skip;if(a)Pe(!1);else{var c=nn[t];if(c){if(!1===e.shallow&&o[t]){var h=JSON.stringify(c._value())===JSON.stringify(o[t]);if(h)return}o=i({},o,((n={})[t]=c._value(),n));var f=$n(t),p=ln(u)?"["+f+"] - "+s+" (ids: "+u+")":"["+f+"] - "+s;e.logTrace&&(console.group(p),console.trace(),console.groupEnd()),r.send({type:p},o)}}})),Qn.push(r.subscribe(function(e){if("ACTION"===e.type){var n=a(e.payload.split("."),1),i=n[0];nn[i]&&t.run(function(){var t=e.payload.replace(i,"this['"+i+"']");try{new Function(""+t).call(nn)}catch(t){console.warn("Unknown Method ☹️")}})}if("DISPATCH"===e.type){var s=e.payload.type;if("COMMIT"===s)return void r.init(o);if(e.state)for(var u=JSON.parse(e.state),c=function(e,n){var r=n[e];nn[r]&&t.run(function(){nn[r]._setState(function(){return u[r]},!1)})},h=0,f=Object.keys(u);h<f.length;h++)c(h,f)}}))},t.applyTransaction=De,t.arrayAdd=function(t,e,n){void 0===n&&(n={});var r=cn(e),i=function(t){return n.prepend?c(r,t):c(t,r)};if(ae(t))return i(t);return function(e){var n;return(n={})[t]=i(e[t]),n}},t.arrayFind=function(t,e){return function(n){return n.pipe(at(function(n){return!1===ae(n)?n:tr(n,t,e||bn)}),er(),at(function(e){return!1===ae(e)?e:ae(t)||$e(t)?e:e[0]}))}},t.arrayRemove=function(t,e,n){void 0===n&&(n=bn);var r,i;$e(e)?(o=e,i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!o.apply(void 0,c(t))}):(r=cn(e),i=function(t){return!1===r.includes(sn(t)?t[n]:t)});var o;if(Array.isArray(t))return t.filter(i);return function(e){var n;return(n={})[t]=e[t].filter(i),n}},t.arrayUpdate=function(t,e,n,r){void 0===r&&(r=bn);var o;if($e(e))o=e;else{var s=cn(e);o=function(t){return!0===s.includes(sn(t)?t[r]:t)}}var u=function(t){return t.map(function(t){return!0===o(t)?sn(t)?i({},t,n):n:t})};if(ae(t))return u(t);return function(e){var n;return(n={})[t]=u(e[t]),n}},t.coerceArray=cn,t.commit=Ue,t.compareValues=Pn,t.createEntityQuery=function(t,e){return new In(t,e)},t.createEntityStore=function(t,e){return new gn(t,e)},t.createQuery=function(t){return new Sn(t)},t.createStore=function(t,e){return new rn(t,e)},t.dispatchAdded=We,t.dispatchDeleted=ze,t.dispatchUpdate=Je,t.distinctUntilArrayItemChanged=er,t.enableAkitaProdMode=function(){t.__DEV__=Xe=!1},t.endBatch=ke,t.entitiesToArray=On,t.entitiesToMap=An,t.find=tr,t.getActiveEntities=un,t.getAkitaConfig=Me,t.getExitingActives=ye,t.getNestedPath=Jn,t.getValue=Nn,t.guid=function(){return"xxxxxx4xyx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},t.hasActiveState=pe,t.hasEntity=fe,t.isArray=ae,t.isDefined=ln,t.isDev=Ge,t.isEmpty=ce,t.isEntityState=ve,t.isFunction=$e,t.isMultiActiveState=le,t.isNil=on,t.isNumber=function(t){return!ae(t)&&t-parseFloat(t)+1>=0},t.isObject=sn,t.isPlainObject=qe,t.isString=wn,t.isTransactionInProcess=Ve,t.isUndefined=yn,t.logAction=Ee,t.persistState=function(t){if(en)return;var e,n={key:"AkitaStores",storage:"undefined"==typeof localStorage?t.storage:localStorage,deserialize:JSON.parse,serialize:JSON.stringify,include:[],exclude:[],persistOnDestroy:!1,preStorageUpdate:function(t,e){return e},preStoreUpdate:function(t,e){return e},skipStorageUpdate:Un,preStorageUpdateOperator:function(){return function(t){return t}}},r=Object.assign({},n,t),o=r.storage,s=r.deserialize,u=r.serialize,a=r.include,c=r.exclude,h=r.key,f=r.preStorageUpdate,p=r.persistOnDestroy,l=r.preStorageUpdateOperator,d=r.preStoreUpdate,y=r.skipStorageUpdate,v=a.length>0,b=c.length>0;if(v&&b)throw new me("You can't use both include and exclude");v&&(e=a.reduce(function(t,e){var n=e.split(".")[0];return t[n]=e,t},{}));var g={},m={},_=[],w=[];var S="undefined"!=typeof localStorage&&(o===localStorage||o===sessionStorage);return Dn(o.getItem(h)).subscribe(function(t){var n=sn(t)?t:s(t||"{}");function r(t){n.$cache=i({},n.$cache||{},t);var e=Object.assign({},n,m);w.push(o.setItem(h,S?u(e):e)),function t(e){Dn(e).subscribe(function(){var e=w.shift();e&&t(e)})}(w.shift())}function a(t,e){g[t]=nn[t]._select(function(t){return Nn(t,e)}).pipe(ne(1),Lt(function(){return!1===y()}),l()).subscribe(function(e){m[t]=f(t,e),Promise.resolve().then(function(){var e;return r(((e={})[t]=nn[t]._cache().getValue(),e))})})}function E(t,e,r){if(t in n){xe("@PersistState"),e._setState(function(e){return jn(e,r,d(t,n[t]))});var i=!!n.$cache&&n.$cache[t];nn[t].setHasCache(i),e.setDirty&&e.setDirty()}}_.push(Qe.subscribe(function(t){g[t]&&(!1===p&&(delete n[t],r(!1)),g[t].unsubscribe(),g[t]=null)})),_.push(Ye.subscribe(function(t){if(!b||!c.includes(t)){var n=nn[t];if(v){var r=e[t];if(!r)return;E(t,n,r),a(t,r)}else E(t,n,t),a(t,t)}}))}),{destroy:function(){_.forEach(function(t){return t.unsubscribe()});for(var t=0,e=Object.keys(g);t<e.length;t++){var n=e[t];g[n].unsubscribe()}g={}},clear:function(){o.clear()},clearStore:function(t){on(t)?Dn(o.setItem(h,"{}")).subscribe():Dn(o.getItem(h)).subscribe(function(e){var n=s(e||"{}");n[t]&&(delete n[t],Dn(o.setItem(h,u(n))).subscribe())})}}},t.removeAllEntities=fn,t.removeEntities=hn,t.resetCustomAction=Se,t.resetStores=function(t){t=Object.assign({},{exclude:[]},t);var e=Object.keys(nn);De(function(){var n,r;try{for(var i=u(e),o=i.next();!o.done;o=i.next()){var s=o.value,a=nn[s];t.exclude?-1===t.exclude.indexOf(a.storeName)&&a.reset():a.reset()}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}})},t.resolveActiveEntity=de,t.runStoreAction=function(t,e,n){var r=nn[t];if(on(r))throw new me(t+" doesn't exist");switch(e){case Zn.SetEntities:var i=n.payload;return void r.set(i.data);case Zn.AddEntities:var i=n.payload;return void r.add(i.data,i.params);case Zn.UpdateEntities:var i=n.payload;return void r.update(i.entityIds,i.data);case Zn.RemoveEntities:var i=n.payload;return void r.remove(i.entityIds);case Zn.Update:var i=n.payload;return void r.update(i.data)}},t.setAction=xe,t.setEntities=ge,t.setSkipAction=Pe,t.setValue=jn,t.sortByOptions=En,t.startBatch=je,t.toBoolean=Be,t.toEntitiesIds=function(t,e){void 0===e&&(e=bn);var n,r,i=[];try{for(var o=u(t),s=o.next();!s.done;s=o.next()){var a=s.value;i.push(a[e])}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.toEntitiesObject=he,t.transaction=Fe,t.updateEntities=dn,t.waitForTransaction=function(){return function(t){return Ce.pipe(oe(function(e){return e?t.pipe((n=Ie,function(t){return t.lift(new Ut(n))}),at(function(t){return t[0]})):t;var n}))}},t.withTransaction=function(t){return function(e){return e.pipe((n=function(e){return De(function(){return t(e)})},function(t){return t.lift(new Jt(n,r,i))}));var n,r,i}},t.ɵb=t.ɵa=t.transactionManager=t.snapshotManager=t.queryConfigKey=t.isNotBrowser=t.getInitialEntitiesState=t.filterNil=t.dirtyCheckDefaultParams=t.currentAction=t.configKey=t.__stores__=t.__DEV__=t.StoreActions=t.Store=t.StateHistoryPlugin=t.SnapshotManager=t.QueryEntity=t.Query=t.PersistNgFormPlugin=t.PaginatorPlugin=t.Paginator=t.Order=t.EntityUIStore=t.EntityUIQuery=t.EntityStore=t.EntityStateHistoryPlugin=t.EntityDirtyCheckPlugin=t.EntityCollectionPlugin=t.EntityActions=t.DirtyCheckPlugin=t.DEFAULT_ID_KEY=t.AkitaPlugin=t.$$updateStore=t.$$deleteStore=t.$$addStore=void 0;var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o(t,n,r,i){var o,s=arguments.length,u=s<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,r):i;if("object"===("undefined"==typeof Reflect?"undefined":e(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,n,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(u=(s<3?o(u):s>3?o(n,r,u):o(n,r))||u);return s>3&&u&&Object.defineProperty(n,r,u),u}function s(t,n){if("object"===("undefined"==typeof Reflect?"undefined":e(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)}function u(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}function h(t){return"function"==typeof t}var f=!1,p={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;f=t},get useDeprecatedSynchronousErrorHandling(){return f}};function l(t){setTimeout(function(){throw t})}var d={closed:!0,next:function(t){},error:function(t){if(p.useDeprecatedSynchronousErrorHandling)throw t;l(t)},complete:function(){}},y=Array.isArray||function(t){return t&&"number"==typeof t.length};function v(t){return null!==t&&"object"===e(t)}function b(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}b.prototype=Object.create(Error.prototype);var g=b,m=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var n=this._parent,r=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,u=r?r.length:0;n;)n.remove(this),n=++s<u&&r[s]||null;if(h(i))try{i.call(this)}catch(n){e=!0,t=n instanceof g?_(n.errors):[n]}if(y(o))for(s=-1,u=o.length;++s<u;){var a=o[s];if(v(a))try{a.unsubscribe()}catch(n){e=!0,t=t||[],n instanceof g?t=t.concat(_(n.errors)):t.push(n)}}if(e)throw new g(t)}},t.prototype.add=function(n){var r=n;switch(e(n)){case"function":r=new t(n);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var i=r;(r=new t)._subscriptions=[i]}break;default:if(!n)return t.EMPTY;throw new Error("unrecognized teardown "+n+" added to Subscription.")}if(r._addParent(this)){var o=this._subscriptions;o?o.push(r):this._subscriptions=[r]}return r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._addParent=function(t){var e=this._parent,n=this._parents;return e!==t&&(e?n?-1===n.indexOf(t)&&(n.push(t),!0):(this._parents=[t],!0):(this._parent=t,!0))},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function _(t){return t.reduce(function(t,e){return t.concat(e instanceof g?e.errors:e)},[])}var w="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),S=function(t){function n(r,i,o){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=d;break;case 1:if(!r){s.destination=d;break}if("object"===e(r)){r instanceof n?(s.syncErrorThrowable=r.syncErrorThrowable,s.destination=r,r.add(s)):(s.syncErrorThrowable=!0,s.destination=new E(s,r));break}default:s.syncErrorThrowable=!0,s.destination=new E(s,r,i,o)}return s}return r(n,t),n.prototype[w]=function(){return this},n.create=function(t,e,r){var i=new n(t,e,r);return i.syncErrorThrowable=!1,i},n.prototype.next=function(t){this.isStopped||this._next(t)},n.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},n.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},n.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this},n}(m),E=function(t){function e(e,n,r,i){var o,s=t.call(this)||this;s._parentSubscriber=e;var u=s;return h(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==d&&(h((u=Object.create(n)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=o,s._error=r,s._complete=i,s}return r(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;p.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=p.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):l(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;l(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};p.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),p.useDeprecatedSynchronousErrorHandling)throw t;l(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!p.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return p.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(l(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(S);var x="function"==typeof Symbol&&Symbol.observable||"@@observable";function P(){}var O=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof S)return t;if(t[w])return t[w]()}return t||e||n?new S(t,e,n):new S(d)}(t,e,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||p.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),p.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){p.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof S?r:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=A(e))(function(e,r){var i;i=n.subscribe(function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[x]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return 0===e.length?this:((t=e)?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:P)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=A(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function A(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}function I(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}I.prototype=Object.create(Error.prototype);var C=I,N=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(m),j=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return r(e,t),e}(S),k=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r(e,t),e.prototype[w]=function(){return new j(this)},e.prototype.lift=function(t){var e=new V(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new C;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new C;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new C;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new C;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new C;return this.hasError?(t.error(this.thrownError),m.EMPTY):this.isStopped?(t.complete(),m.EMPTY):(this.observers.push(t),new N(this,t))},e.prototype.asObservable=function(){var t=new O;return t.source=this,t},e.create=function(t,e){return new V(t,e)},e}(O),V=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return r(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):m.EMPTY},e}(k);var U=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new D(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i},t}(),D=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return r(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(S),F=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new m).add(this.source.subscribe(new K(this.getSubject(),this))),t.closed?(this._connection=null,t=m.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return(t=this).lift(new U(t));var t},e}(O).prototype,K=(F._subscribe,F._isComplete,F.getSubject,F.connect,F.refCount,function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return r(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(j)),R=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return r(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new C;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(k),H=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return r(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return r(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(m)),M=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return r(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(H),B=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),q=function(t){function e(n,r){void 0===r&&(r=B.now);var i=t.call(this,n,function(){return e.delegate&&e.delegate!==i?e.delegate.now():r()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return r(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(B),$=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(q))(M),Q=new O(function(t){return t.complete()});function Y(t){return t?function(t){return new O(function(e){return t.schedule(function(){return e.complete()})})}(t):Q}function L(t){return t&&"function"==typeof t.schedule}var z=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.closed||e.complete()}};function W(t,e){return new O(e?function(n){var r=new m,i=0;return r.add(e.schedule(function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()})),r}:z(t))}function J(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,r,i=t[t.length-1];switch(L(i)?t.pop():i=void 0,t.length){case 0:return Y(i);case 1:return i?W(t,i):(n=t[0],(r=new O(function(t){t.next(n),t.complete()}))._isScalar=!0,r.value=n,r);default:return W(t,i)}}function X(t){var e=t.error;t.subscriber.error(e)}var G=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){var t,e;switch(this.kind){case"N":return J(this.value);case"E":return t=this.error,new O(e?function(n){return e.schedule(X,0,{error:t,subscriber:n})}:function(e){return e.error(t)});case"C":return Y()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}(),Z=function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this,e)||this;return i.scheduler=n,i.delay=r,i}return r(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new tt(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(G.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(G.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(G.createComplete()),this.unsubscribe()},e}(S),tt=function(){return function(t,e){this.notification=t,this.destination=e}}(),et=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r(e,t),e.prototype.nextInfiniteTimeWindow=function(e){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift(),t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this._events.push(new nt(this._getNow(),e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new C;if(this.isStopped||this.hasError?e=m.EMPTY:(this.observers.push(t),e=new N(this,t)),i&&t.add(t=new Z(t,i)),n)for(var s=0;s<o&&!t.closed;s++)t.next(r[s]);else for(s=0;s<o&&!t.closed;s++)t.next(r[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||$).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r},e}(k),nt=function(){return function(t,e){this.time=t,this.value=e}}(),rt=new q(H);function it(t){return t}function ot(t){return!!t&&(t instanceof O||"function"==typeof t.lift&&"function"==typeof t.subscribe)}function st(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}st.prototype=Object.create(Error.prototype);var ut=st;function at(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new ct(t,e))}}var ct=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ht(t,this.project,this.thisArg))},t}(),ht=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(S),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(S),pt=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(S),lt=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,l),e}};function dt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var yt=dt(),vt=function(t){return function(e){for(var n=t[yt]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e}},bt=function(t){return function(e){var n=t[x]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},gt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function mt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var _t=function(t){if(t instanceof O)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[x])return bt(t);if(gt(t))return z(t);if(mt(t))return lt(t);if(t&&"function"==typeof t[yt])return vt(t);var e=v(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function wt(t,e,n,r,i){if(void 0===i&&(i=new pt(t,n,r)),!i.closed)return _t(e)(i)}var St={};function Et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null,r=null;return L(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&y(t[0])&&(t=t[0]),W(t,r).lift(new xt(n))}var xt=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Pt(t,this.resultSelector))},t}(),Pt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r(e,t),e.prototype._next=function(t){this.values.push(St),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(wt(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.values,s=o[n],u=this.toRespond?s===St?--this.toRespond:this.toRespond:0;o[n]=e,0===u&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(ft);function Ot(t,n){if(!n)return t instanceof O?t:new O(_t(t));if(null!=t){if(function(t){return t&&"function"==typeof t[x]}(t))return function(t,e){return new O(e?function(n){var r=new m;return r.add(e.schedule(function(){var i=t[x]();r.add(i.subscribe({next:function(t){r.add(e.schedule(function(){return n.next(t)}))},error:function(t){r.add(e.schedule(function(){return n.error(t)}))},complete:function(){r.add(e.schedule(function(){return n.complete()}))}}))})),r}:bt(t))}(t,n);if(mt(t))return function(t,e){return new O(e?function(n){var r=new m;return r.add(e.schedule(function(){return t.then(function(t){r.add(e.schedule(function(){n.next(t),r.add(e.schedule(function(){return n.complete()}))}))},function(t){r.add(e.schedule(function(){return n.error(t)}))})})),r}:lt(t))}(t,n);if(gt(t))return W(t,n);if(function(t){return t&&"function"==typeof t[yt]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new O(e?function(n){var r,i=new m;return i.add(function(){r&&"function"==typeof r.return&&r.return()}),i.add(e.schedule(function(){r=t[yt](),i.add(e.schedule(function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}}))})),i}:vt(t))}(t,n)}throw new TypeError((null!==t&&e(t)||t)+" is not observable")}var At=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new It(t,this.project,this.concurrent))},t}(),It=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new pt(this,void 0,void 0);this.destination.add(r),wt(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(ft);function Tt(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),function t(e,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof n?function(i){return i.pipe(t(function(t,r){return Ot(e(t,r)).pipe(at(function(e,i){return n(t,e,r,i)}))},r))}:("number"==typeof n&&(r=n),function(t){return t.lift(new At(e,r))})}(it,t)}function Ct(t){return!y(t)&&t-parseFloat(t)+1>=0}function Nt(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}var jt=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new kt(t,this.durationSelector))},t}(),kt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return r(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(t){return this.destination.error(t)}var n=wt(this,e);!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},e.prototype.clearThrottle=function(){var t=this.value,e=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))},e.prototype.notifyNext=function(t,e,n,r){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}(ft);function Vt(t,e){return void 0===e&&(e=rt),n=function(){return function(t,e,n){void 0===t&&(t=0);var r=-1;return Ct(e)?r=Number(e)<1?1:Number(e):L(e)&&(n=e),L(n)||(n=rt),new O(function(e){var i=Ct(t)?t:+t-n.now();return n.schedule(Nt,i,{index:0,period:r,subscriber:e})})}(t,e)},function(t){return t.lift(new jt(n))};var n}var Ut=function(){function t(t){this.closingNotifier=t}return t.prototype.call=function(t,e){return e.subscribe(new Dt(t,this.closingNotifier))},t}(),Dt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.buffer=[],r.add(wt(r,n)),r}return r(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},e}(ft);var Ft=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Kt(t,this.dueTime,this.scheduler))},t}(),Kt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Rt,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(S);function Rt(t){t.debouncedNext()}function Ht(t,e){void 0===e&&(e=rt);var n,r=(n=t)instanceof Date&&!isNaN(+n)?+t-e.now():Math.abs(t);return function(t){return t.lift(new Mt(r,e))}}var Mt=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Bt(t,this.delay,this.scheduler))},t}(),Bt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new qt(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(G.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(G.createComplete()),this.unsubscribe()},e}(S),qt=function(){return function(t,e){this.time=t,this.notification=e}}();function $t(t,e){return function(n){return n.lift(new Qt(t,e))}}var Qt=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Yt(t,this.compare,this.keySelector))},t}(),Yt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(t){return this.destination.error(t)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))},e}(S);function Lt(t,e){return function(n){return n.lift(new zt(t,e))}}var zt=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Wt(t,this.predicate,this.thisArg))},t}(),Wt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(S);var Jt=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new Xt(t,this.nextOrObserver,this.error,this.complete))},t}(),Xt=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o._tapNext=P,o._tapError=P,o._tapComplete=P,o._tapError=r||P,o._tapComplete=i||P,h(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||P,o._tapError=n.error||P,o._tapComplete=n.complete||P),o}return r(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(S);var Gt=function(){function t(t){if(this.total=t,this.total<0)throw new ut}return t.prototype.call=function(t,e){return e.subscribe(new Zt(t,this.total))},t}(),Zt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(S);var te=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new ee(t))},t}(),ee=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return r(e,t),e.prototype._next=function(t){this.hasPrev?this.destination.next([this.prev,t]):this.hasPrev=!0,this.prev=t},e}(S);function ne(t){return function(e){return e.lift(new re(t))}}var re=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new ie(t,this.total))},t}(),ie=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return r(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(S);function oe(t,e){return"function"==typeof e?function(n){return n.pipe(oe(function(n,r){return Ot(t(n,r)).pipe(at(function(t,i){return e(n,t,r,i)}))}))}:function(e){return e.lift(new se(t))}}var se=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new ue(t,this.project))},t}(),ue=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return r(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new pt(this,void 0,void 0);this.destination.add(i),this.innerSubscription=wt(this,t,e,n,i)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e}(ft);function ae(t){return Array.isArray(t)}function ce(t){return!!ae(t)&&0===t.length}function he(t,e,n){var r,i,o={entities:{},ids:[]};try{for(var s=u(t),a=s.next();!a.done;a=s.next()){var c=n(a.value);o.entities[c[e]]=c,o.ids.push(c[e])}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}function fe(t,e){return t.hasOwnProperty(e)}function pe(t){return t.hasOwnProperty("active")}function le(t){return ae(t)}function de(t){var e=t.active,n=t.ids,r=t.entities;return le(e)?ye(e,n):!1===fe(r,e)?null:e}function ye(t,e){var n=t.filter(function(t){return e.indexOf(t)>-1});return n.length===t.length?t:n}function ve(t){return t.entities&&t.ids}function be(t,e){var n,r,i={};try{for(var o=u(Object.keys(t)),s=o.next();!s.done;s=o.next()){var a=s.value;i[a]=e(t[a])}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}function ge(t){var e,n,r=t.state,o=t.entities,s=t.idKey,u=t.preAddEntity,a=t.isNativePreAdd;if(ae(o)){var c=he(o,s,u);e=c.entities,n=c.ids}else ve(o)?(e=a?o.entities:be(o.entities,u),n=o.ids):(e=a?o:be(o,u),n=Object.keys(e).map(function(t){return isNaN(t)?t:Number(t)}));var h=i({},r,{entities:e,ids:n,loading:!1});return pe(r)&&(h.active=de(h)),h}var me=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e}(Error);var _e={type:null,entityIds:null,skip:!1};t.currentAction=_e;var we=!1;function Se(){we=!1}function Ee(t,e){xe(t,e),we=!0}function xe(t,e){!1===we&&(_e.type=t,_e.entityIds=e)}function Pe(t){void 0===t&&(t=!0),_e.skip=t}function Oe(t,e){return function(n,r,i){var o=i.value;return i.value=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Ee(t,e),o.apply(this,n)},i}}var Ae=new k,Ie=Ae.asObservable(),Te=new R(!1),Ce=Te.asObservable(),Ne={activeTransactions:0,batchTransaction:null};function je(){Ve()||(Ne.batchTransaction=new k),Ne.activeTransactions++,Te.next(!0)}function ke(){0==--Ne.activeTransactions&&(Ne.batchTransaction.next(!0),Ne.batchTransaction.complete(),Te.next(!1),Ae.next(!0))}function Ve(){return Ne.activeTransactions>0}function Ue(){return Ne.batchTransaction?Ne.batchTransaction.asObservable():J(!0)}function De(t,e){void 0===e&&(e=void 0),je();try{return t.apply(e)}finally{Ee("@Transaction"),ke()}}function Fe(){return function(t,e,n){var r=n.value;return n.value=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return De(function(){return r.apply(t,e)},this)},n}}function Ke(t){Object.freeze(t);var n="function"==typeof t,r=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(t).forEach(function(i){!r.call(t,i)||n&&("caller"===i||"callee"===i||"arguments"===i)||null===t[i]||"object"!==e(t[i])&&"function"!=typeof t[i]||Object.isFrozen(t[i])||Ke(t[i])}),t}t.transactionManager=Ne;var Re="akitaConfig";t.configKey=Re;var He={resettable:!1};function Me(){return He}function Be(t){return null!=t&&""+t!="false"}function qe(t){return Be(t)&&"Object"===t.constructor.name}function $e(t){return"function"==typeof t}var Qe=new k;t.$$deleteStore=Qe;var Ye=new et(50,5e3);t.$$addStore=Ye;var Le=new k;function ze(t){Qe.next(t)}function We(t){Ye.next(t)}function Je(t){Le.next(t)}t.$$updateStore=Le;var Xe=!0;function Ge(){return Xe}t.__DEV__=Xe;var Ze="undefined"!=typeof window;t.ɵa=Ze;var tn="undefined"!=typeof global&&void 0!==global.__runtimeVersion;t.ɵb=tn;var en=!Ze&&!tn;t.isNotBrowser=en;var nn={};t.__stores__=nn,Ze&&Ge()&&(window.$$stores=nn);var rn=function(){function t(t,e){void 0===e&&(e={}),this.options=e,this.inTransaction=!1,this.cache={active:new R(!1),ttl:null},this.onInit(t)}return t.prototype.setLoading=function(t){void 0===t&&(t=!1),t!==this._value().loading&&(Ge()&&xe("Set Loading"),this._setState(function(e){return i({},e,{loading:t})}))},t.prototype.setHasCache=function(t){t!==this.cache.active.value&&this.cache.active.next(t)},t.prototype.setError=function(t){t!==this._value().error&&(Ge()&&xe("Set Error"),this._setState(function(e){return i({},e,{error:t})}))},t.prototype._select=function(t){return this.store.asObservable().pipe(at(t),$t())},t.prototype._value=function(){return this.storeValue},t.prototype._cache=function(){return this.cache.active},Object.defineProperty(t.prototype,"config",{get:function(){return this.constructor[Re]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storeName",{get:function(){return this.config.storeName||this.options.storeName||this.options.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deepFreeze",{get:function(){return this.config.deepFreezeFn||this.options.deepFreezeFn||Ke},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheConfig",{get:function(){return this.config.cache||this.options.cache},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resettable",{get:function(){return this.config.resettable||this.options.resettable},enumerable:!0,configurable:!0}),t.prototype._setState=function(t,e){void 0===e&&(e=!0),this.storeValue=Xe?this.deepFreeze(t(this._value())):t(this._value()),this.store?Ve()?this.handleTransaction():this.dispatch(this.storeValue,e):this.store=new R(this.storeValue)},t.prototype.reset=function(){var t=this;this.isResettable()?(Ge()&&xe("Reset"),this._setState(function(){return Object.assign({},t._initialState)}),this.setHasCache(!1)):Ge()&&console.warn("You need to enable the reset functionality")},t.prototype.update=function(t){var e=this;Ge()&&xe("Update"),this._setState(function(n){var r=$e(t)?t(n):t,o=e.akitaPreUpdate(n,i({},n,r));return qe(n)?o:new n.constructor(o)})},t.prototype.updateStoreConfig=function(t){this.options=i({},this.options,t)},t.prototype.akitaPreUpdate=function(t,e){return e},t.prototype.ngOnDestroy=function(){this.destroy()},t.prototype.destroy=function(){en||window.hmrEnabled||this!==nn[this.storeName]||(delete nn[this.storeName],ze(this.storeName),this.setHasCache(!1),this.cache.active.complete())},t.prototype.onInit=function(t){var e,n;nn[this.storeName]=this,this._setState(function(){return t}),We(this.storeName),this.isResettable()&&(this._initialState=t),Ge()&&(e=this.storeName,n=this.constructor.name,e||console.error("@StoreConfig({ name }) is missing in "+n))},t.prototype.dispatch=function(t,e){void 0===e&&(e=!0),this.store.next(t),e&&(Je(this.storeName),Se())},t.prototype.watchTransaction=function(){var t=this;Ue().subscribe(function(){t.inTransaction=!1,t.dispatch(t._value())})},t.prototype.isResettable=function(){return!1!==this.resettable&&(this.resettable||Me().resettable)},t.prototype.handleTransaction=function(){this.inTransaction||(this.watchTransaction(),this.inTransaction=!0)},t}();function on(t){return null==t}function sn(t){var n=e(t);return null!=t&&("object"==n||"function"==n)}function un(t,e,n){var r;if(ae(t))r=t;else if(sn(t)){if(on(n))return;t=Object.assign({wrap:!0},t);var i=e.indexOf(n);if(t.prev){var o=0===i;if(o&&!t.wrap)return;r=o?e[e.length-1]:e[i-1]}else if(t.next){var s=e.length===i+1;if(s&&!t.wrap)return;r=s?e[0]:e[i+1]}}else{if(t===n)return;r=t}return r}function an(t){var e,n,r=t.state,o=t.entities,s=t.idKey,a=t.options,h=void 0===a?{}:a,f=t.preAddEntity,p={},l=[],d=!1;try{for(var y=u(o),v=y.next();!v.done;v=y.next()){var b=v.value;if(!1===fe(r.entities,b[s])){var g=f(b),m=g[s];p[m]=g,h.prepend?l.unshift(m):l.push(m),d=!0}}}catch(t){e={error:t}}finally{try{v&&!v.done&&(n=y.return)&&n.call(y)}finally{if(e)throw e.error}}return d?{newState:i({},r,{entities:i({},r.entities,p),ids:h.prepend?c(l,r.ids):c(r.ids,l)}),newIds:l}:null}function cn(t){return on(t)?[]:Array.isArray(t)?t:[t]}function hn(t){var e,n,r=t.state,o=t.ids;if(on(o))return fn(r);var s=r.entities,a={};try{for(var c=u(r.ids),h=c.next();!h.done;h=c.next()){var f=h.value;!1===o.includes(f)&&(a[f]=s[f])}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}var p=i({},r,{entities:a,ids:r.ids.filter(function(t){return!1===o.includes(t)})});return pe(r)&&(p.active=de(p)),p}function fn(t){return i({},t,{entities:{},ids:[],active:le(t.active)?[]:null})}t.Store=rn;var pn=function(){return{entities:{},ids:[],loading:!0,error:null}};function ln(t){return!1===on(t)}function dn(t){var n,r,o,s=t.state,c=t.ids,h=t.idKey,f=t.newStateOrFn,p=t.preUpdateEntity,l={},d=!1;try{for(var y=u(c),v=y.next();!v.done;v=y.next()){var b=v.value;if(!1!==fe(s.entities,b)){var g=s.entities[b],m=$e(f)?f(g):f,_=m.hasOwnProperty(h)&&m[h]!==g[h],w=void 0;o=b,_&&(d=!0,o=m[h]);var S=i({},g,m);w=qe(g)?S:qe(m)?new g.constructor(S):new m.constructor(S),l[o]=p(g,w)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}var E=s.ids,x=s.entities;if(d){var P=a(c,1)[0],O=s.entities,A=P;O[A];x=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(O,["symbol"===e(A)?A:A+""]),E=s.ids.map(function(t){return t===P?o:t})}return i({},s,{entities:i({},x,l),ids:E})}function yn(t){return void 0===t}t.getInitialEntitiesState=pn;var vn={Set:0,Add:1,Update:2,Remove:3};t.EntityActions=vn,vn[vn.Set]="Set",vn[vn.Add]="Add",vn[vn.Update]="Update",vn[vn.Remove]="Remove";var bn="id";t.DEFAULT_ID_KEY=bn;var gn=function(t){function e(e,n){void 0===e&&(e={}),void 0===n&&(n={});var r=t.call(this,i({},pn(),e),n)||this;return r.options=n,r.updatedEntityIds=new R([]),r.entityActions=new k,r}var n;return r(e,t),Object.defineProperty(e.prototype,"updatedEntityIds$",{get:function(){return this.updatedEntityIds.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectEntityAction$",{get:function(){return this.entityActions.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idKey",{get:function(){return this.config.idKey||this.options.idKey||bn},enumerable:!0,configurable:!0}),e.prototype.set=function(t){var n=this;if(!on(t)){Ge()&&xe("Set Entity");var r=this.akitaPreAddEntity===e.prototype.akitaPreAddEntity;this._setState(function(e){return ge({state:e,entities:t,idKey:n.idKey,preAddEntity:n.akitaPreAddEntity,isNativePreAdd:r})}),this.updateCache(),this.hasInitialUIState()&&this.handleUICreation(),this.entityActions.next({type:vn.Set,ids:this.ids})}},e.prototype.add=function(t,e){void 0===e&&(e={loading:!1});var n=cn(t);if(!ce(n)){Ge()&&xe("Add Entity");var r=an({state:this._value(),preAddEntity:this.akitaPreAddEntity,entities:n,idKey:this.idKey,options:e});r&&(this._setState(function(){return i({},r.newState,{loading:e.loading})}),this.hasInitialUIState()&&this.handleUICreation(!0),this.entityActions.next({type:vn.Add,ids:r.newIds}))}},e.prototype.update=function(e,n){var r=this;if(yn(n))t.prototype.update.call(this,e);else{var i=[];ce(i=$e(e)?this.ids.filter(function(t){return e(r.entities[t])}):on(e)?this.ids:cn(e))||(Ge()&&xe("Update Entity",i),this._setState(function(t){return dn({idKey:r.idKey,ids:i,preUpdateEntity:r.akitaPreUpdateEntity,state:t,newStateOrFn:n})}),this.updatedEntityIds.next(i),this.entityActions.next({type:vn.Update,ids:i}))}},e.prototype.upsert=function(t,e,n){var r=this;void 0===n&&(n={});var o=cn(t),s=function(t){return function(e){return fe(r.entities,e)===t}},u=$e(n.baseClass),a=o.filter(s(!0)),c=o.filter(s(!1)).map(function(t){var o,s=$e(e)?e({}):e,a=i({},s,((o={})[r.idKey]=t,o));return u?new n.baseClass(a):a});this.update(a,e),this.add(c),Ge()&&Ee("Upsert Entity")},e.prototype.upsertMany=function(t,e){var n,r;void 0===e&&(e={});var o=[],s=[],a={};try{for(var h=u(t),f=h.next();!f.done;f=h.next()){var p=f.value,l=p[this.idKey];if(fe(this.entities,l))a[l]=i({},this._value().entities[l],p),s.push(l);else{var d=e.baseClass?new e.baseClass(p):p;o.push(l),a[l]=d}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}Ge()&&Ee("Upsert Many"),this._setState(function(t){return i({},t,{ids:o.length?c(t.ids,o):t.ids,entities:i({},t.entities,a),loading:!!e.loading})}),s.length&&this.updatedEntityIds.next(s),s.length&&this.entityActions.next({type:vn.Update,ids:s}),o.length&&this.entityActions.next({type:vn.Add,ids:o})},e.prototype.replace=function(t,e){var n,r,o=cn(t);if(!ce(o)){var s={};try{for(var a=u(o),c=a.next();!c.done;c=a.next()){var h=c.value;e[this.idKey]=h,s[h]=e}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}Ge()&&xe("Replace Entity",t),this._setState(function(t){return i({},t,{entities:i({},t.entities,s)})})}},e.prototype.remove=function(t){var e=this;if(!ce(this.ids)){var n=ln(t),r=[];ce(r=$e(t)?this.ids.filter(function(n){return t(e.entities[n])}):n?cn(t):null)||(Ge()&&xe("Remove Entity",r),this._setState(function(t){return hn({state:t,ids:r})}),null===r&&this.setHasCache(!1),this.handleUIRemove(r),this.entityActions.next({type:vn.Remove,ids:r}))}},e.prototype.updateActive=function(t){var e=cn(this.active);Ge()&&xe("Update Active",e),this.update(e,t)},e.prototype.setActive=function(t){var e=un(t,this.ids,this.active);void 0!==e&&(Ge()&&xe("Set Active",e),this._setActive(e))},e.prototype.addActive=function(t){var e=this,n=cn(t);ce(n)||(n.every(function(t){return e.active.indexOf(t)>-1})||(Ge()&&xe("Add Active",t),this._setState(function(t){var e=Array.from(new Set(c(t.active,n)));return i({},t,{active:e})})))},e.prototype.removeActive=function(t){var e=this,n=cn(t);ce(n)||n.some(function(t){return e.active.indexOf(t)>-1})&&(Ge()&&xe("Remove Active",t),this._setState(function(t){return i({},t,{active:t.active.filter(function(t){return-1===n.indexOf(t)})})}))},e.prototype.toggleActive=function(t){var e=this,n=cn(t),r=function(t){return function(n){return e.active.includes(n)===t}},i=n.filter(r(!0)),o=n.filter(r(!1));this.removeActive(i),this.addActive(o),Ge()&&Ee("Toggle Active")},e.prototype.createUIStore=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var n={name:"UI/"+this.storeName,idKey:this.idKey};return this.ui=new mn(t,i({},n,e)),this.ui},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.ui instanceof e&&this.ui.destroy(),this.updatedEntityIds.complete(),this.entityActions.complete()},e.prototype.akitaPreUpdateEntity=function(t,e){return e},e.prototype.akitaPreAddEntity=function(t){return t},Object.defineProperty(e.prototype,"ids",{get:function(){return this._value().ids},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entities",{get:function(){return this._value().entities},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this._value().active},enumerable:!0,configurable:!0}),e.prototype._setActive=function(t){this._setState(function(e){return i({},e,{active:t})})},e.prototype.updateCache=function(){var t=this;this.setHasCache(!0);var e=this.cacheConfig&&this.cacheConfig.ttl;e&&(null!==this.cache.ttl&&clearTimeout(this.cache.ttl),this.cache.ttl=setTimeout(function(){return t.setHasCache(!1)},e))},e.prototype.handleUICreation=function(t){var e=this;void 0===t&&(t=!1);var n,r=this.ids,o=$e(this.ui._akitaCreateEntityFn),s=function(t){var n,r=e.entities[t],s=o?e.ui._akitaCreateEntityFn(r):e.ui._akitaCreateEntityFn;return i(((n={})[e.idKey]=r[e.idKey],n),s)};n=t?this.ids.filter(function(t){return yn(e.ui.entities[t])}).map(s):r.map(s),t?this.ui.add(n):this.ui.set(n)},e.prototype.hasInitialUIState=function(){return this.hasUIStore()&&!1===yn(this.ui._akitaCreateEntityFn)},e.prototype.handleUIRemove=function(t){this.hasUIStore()&&this.ui.remove(t)},e.prototype.hasUIStore=function(){return this.ui instanceof mn},o([Fe(),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",void 0)],e.prototype,"upsert",null),o([Fe(),s("design:type",Function),s("design:paramtypes",["function"==typeof(n="undefined"!=typeof T&&T)?n:Object]),s("design:returntype",void 0)],e.prototype,"toggleActive",null),e}(rn);t.EntityStore=gn;var mn=function(t){function e(e,n){return void 0===e&&(e={}),void 0===n&&(n={}),t.call(this,e,n)||this}return r(e,t),e.prototype.setInitialEntityState=function(t){this._akitaCreateEntityFn=t},e}(gn);t.EntityUIStore=mn;var _n="akitaQueryConfig";function wn(t){return"string"==typeof t}t.queryConfigKey=_n;var Sn=function(){function t(t){this.store=t,this.__store__=t}return t.prototype.select=function(t){var e;return e=$e(t)?t:wn(t)?function(e){return e[t]}:function(t){return t},this.store._select(e)},t.prototype.selectLoading=function(){return this.select(function(t){return t.loading})},t.prototype.selectError=function(){return this.select(function(t){return t.error})},t.prototype.getValue=function(){return this.store._value()},t.prototype.selectHasCache=function(){return this.store._cache().asObservable()},t.prototype.getHasCache=function(){return this.store._cache().value},Object.defineProperty(t.prototype,"config",{get:function(){return this.constructor[_n]},enumerable:!0,configurable:!0}),t}();function En(t,e){t.sortBy=t.sortBy||e&&e.sortBy,t.sortByOrder=t.sortByOrder||e&&e.sortByOrder}t.Query=Sn;var xn={ASC:"asc",DESC:"desc"};function Pn(t,e){return void 0===e&&(e=xn.ASC),function(n,r){if(!n.hasOwnProperty(t)||!r.hasOwnProperty(t))return 0;var i="string"==typeof n[t]?n[t].toUpperCase():n[t],o="string"==typeof r[t]?r[t].toUpperCase():r[t],s=0;return i>o?s=1:i<o&&(s=-1),e==xn.DESC?-1*s:s}}function On(t,e){for(var n=[],r=t.ids,i=t.entities,o=e.filterBy,s=e.limitTo,u=e.sortBy,a=e.sortByOrder,c=function(t){var e=i[r[t]];if(!o)return n.push(e),"continue";cn(o).every(function(n){return n(e,t)})&&n.push(e)},h=0;h<r.length;h++)c(h);if(u){var f=$e(u)?u:Pn(u,a);n=n.sort(function(e,n){return f(e,n,t)})}var p=Math.min(s||n.length,n.length);return p===n.length?n:n.slice(0,p)}function An(t,e){var n={},r=e.filterBy,i=e.limitTo,o=t.ids,s=t.entities;if(!r&&!i)return s;var u=!1===on(i);if(r&&u)for(var a=0,c=function(t,e){if(a===i)return"break";var u=o[t],c=s[u];cn(r).every(function(e){return e(c,t)})&&(n[u]=c,a++)},h=0,f=o.length;h<f;h++){if("break"===c(h))break}else{var p=Math.min(i||o.length,o.length),l=function(t){var e=o[t],i=s[e];if(!r)return n[e]=i,"continue";cn(r).every(function(e){return e(i,t)})&&(n[e]=i)};for(h=0;h<p;h++)l(h)}return n}t.Order=xn;var In=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,e)||this;return r.options=n,r.__store__=e,r}return r(e,t),e.prototype.selectAll=function(t){var e=this;return void 0===t&&(t={asObject:!1}),this.select(function(t){return t.entities}).pipe(at(function(){return e.getAll(t)}))},e.prototype.getAll=function(t){return void 0===t&&(t={asObject:!1,filterBy:void 0,limitTo:void 0}),t.asObject?An(this.getValue(),t):(En(t,this.config||this.options),On(this.getValue(),t))},e.prototype.selectMany=function(t,e){var n=this;return t&&t.length?Et(t.map(function(t){return n.selectEntity(t,e)})).pipe(at(function(t){return t.filter(Boolean)}),Vt(0)):J([])},e.prototype.selectEntity=function(t,e){var n=t;return $e(t)&&(n=function(t,e){var n,r;try{for(var i=u(Object.keys(e)),o=i.next();!o.done;o=i.next()){var s=o.value;if(!0===t(e[s]))return s}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}(t,this.getValue().entities)),this.select(function(t){return t.entities}).pipe(at(function(t,e){return function(n){var r=n[t];if(!yn(r))return e?wn(e)?r[e]:e(r):r}}(n,e)),$t())},e.prototype.getEntity=function(t){return this.getValue().entities[t]},e.prototype.selectActiveId=function(){return this.select(function(t){return t.active})},e.prototype.getActiveId=function(){return this.getValue().active},e.prototype.selectActive=function(t){var e=this;return ae(this.getActive())?this.selectActiveId().pipe(oe(function(n){return e.selectMany(n,t)})):this.selectActiveId().pipe(oe(function(n){return e.selectEntity(n,t)}))},e.prototype.getActive=function(){var t=this,e=this.getActiveId();return ae(e)?e.map(function(e){return t.getValue().entities[e]}):Be(e)?this.getEntity(e):void 0},e.prototype.selectCount=function(t){var e=this;return this.select(function(t){return t.entities}).pipe(at(function(){return e.getCount(t)}))},e.prototype.getCount=function(t){return $e(t)?this.getAll().filter(t).length:this.getValue().ids.length},e.prototype.selectLast=function(t){return this.selectAt(function(t){return t[t.length-1]},t)},e.prototype.selectFirst=function(t){return this.selectAt(function(t){return t[0]},t)},e.prototype.selectUpdatedEntityIds=function(){return this.store.updatedEntityIds$},e.prototype.selectEntityAction=function(t){return yn(t)?this.store.selectEntityAction$:this.store.selectEntityAction$.pipe(Lt(function(e){return e.type===t}),at(function(t){return t.ids}))},e.prototype.hasEntity=function(t){var e=this;return on(t)?this.getValue().ids.length>0:$e(t)?this.getAll().some(t):ae(t)?t.every(function(t){return t in e.getValue().entities}):t in this.getValue().entities},e.prototype.hasActive=function(t){var e=this.getValue().active;return Array.isArray(e)?ln(t)?e.includes(t):e.length>0:ln(e)},e.prototype.createUIQuery=function(){this.ui=new Tn(this.__store__.ui)},e.prototype.selectAt=function(t,e){var n=this;return this.select(function(t){return t.ids}).pipe(at(t),$t(),oe(function(t){return n.selectEntity(t,e)}))},e}(Sn);t.QueryEntity=In;var Tn=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e}(In);t.EntityUIQuery=Tn;var Cn=function(t){return t.pipe(Lt(function(t){return null!=t}))};function Nn(t,e){return 1===e.split(".").length?t:e.split(".").slice(1).join(".").split(".").reduce(function(t,e){return t&&t[e]},t)}function jn(t,e,n){var r=e.split(".");if(1===r.length)return n;t=i({},t);var o=r.length-2;return e.split(".").slice(1).reduce(function(t,e,r){return t[e]=r===o?n:i({},t[e]),t&&t[e]},t),t}t.filterNil=Cn;var kn=!1;function Vn(t){kn=t}function Un(){return kn}function Dn(t){return(e=t)&&$e(e.then)||ot(t)?Ot(t):J(t);var e}var Fn=function(){function t(){}return t.prototype.getStoresSnapshot=function(t){void 0===t&&(t=[]);for(var e={},n=t.length>0?t:Object.keys(nn),r=0;r<n.length;r++){var i=n[r];e[i]=nn[i]._value()}return e},t.prototype.setStoresSnapshot=function(t,e){void 0===e&&(e={skipStorageUpdate:!1}),e.skipStorageUpdate&&Vn(!0);var n=t;wn(t)&&(n=JSON.parse(n));for(var r=function(t,e){var r=e[t];nn[r]&&nn[r]._setState(function(){return n[r]})},i=0,o=Object.keys(n);i<o.length;i++)r(i,o);e.skipStorageUpdate&&Vn(!1)},t}();t.SnapshotManager=Fn;var Kn=new Fn;t.snapshotManager=Kn;var Rn=function(){function t(t,e){this.query=t,e&&e.resetFn&&Me().resettable&&this.onReset(e.resetFn)}return t.prototype.getQuery=function(){return this.query},t.prototype.getStore=function(){return this.getQuery().__store__},t.prototype.isEntityBased=function(t){return Be(t)},t.prototype.selectSource=function(t){return this.isEntityBased(t)?this.getQuery().selectEntity(t).pipe(Cn):this.getQuery().select(function(t){return t})},t.prototype.getSource=function(t){return this.isEntityBased(t)?this.getQuery().getEntity(t):this.getQuery().getValue()},t.prototype.updateStore=function(t,e){this.isEntityBased(e)?this.getStore().update(e,t):this.getStore()._setState(function(e){return i({},e,t)})},t.prototype.onReset=function(t){var e=this,n=this.getStore().reset;this.getStore().reset=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];setTimeout(function(){n.apply(e.getStore(),r),t()})}},t}();t.AkitaPlugin=Rn;var Hn={pagesControls:!1,range:!1,startWith:1,cacheTimeout:void 0,clearStoreWithCache:!0},Mn=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,e,{resetFn:function(){r.initial=!1,r.destroy({clearCache:!0,currentPage:1})}})||this;r.query=e,r.config=n,r.metadata=new Map,r.pages=new Map,r.pagination={currentPage:1,perPage:0,total:0,lastPage:0,data:[]},r.initial=!0,r.isLoading$=r.query.selectLoading().pipe(Ht(0)),r.config=Object.assign(Hn,n);var i=r.config,o=i.startWith,s=i.cacheTimeout;return r.page=new R(o),ot(s)&&(r.clearCacheSubscription=s.subscribe(function(t){return r.clearCache()})),r}return r(e,t),Object.defineProperty(e.prototype,"pageChanges",{get:function(){return this.page.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){return this.pagination.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFirst",{get:function(){return 1===this.currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLast",{get:function(){return this.currentPage===this.pagination.lastPage},enumerable:!0,configurable:!0}),e.prototype.withControls=function(){return this.config.pagesControls=!0,this},e.prototype.withRange=function(){return this.config.range=!0,this},e.prototype.setLoading=function(t){void 0===t&&(t=!0),this.getStore().setLoading(t)},e.prototype.update=function(t){this.pagination=t,this.addPage(t.data)},e.prototype.addPage=function(t){var e=this;this.pages.set(this.currentPage,{ids:t.map(function(t){return t[e.getStore().idKey]})}),this.getStore().add(t)},e.prototype.clearCache=function(t){void 0===t&&(t={}),this.initial||(Ee("@Pagination - Clear Cache"),!1!==t.clearStore&&(this.config.clearStoreWithCache||t.clearStore)&&this.getStore().remove(),this.pages=new Map,this.metadata=new Map),this.initial=!1},e.prototype.clearPage=function(t){this.pages.delete(t)},e.prototype.destroy=function(t){var e=void 0===t?{}:t,n=e.clearCache,r=e.currentPage;this.clearCacheSubscription&&this.clearCacheSubscription.unsubscribe(),n&&this.clearCache(),yn(r)||this.setPage(r),this.initial=!0},e.prototype.isPageActive=function(t){return this.currentPage===t},e.prototype.setPage=function(t){t===this.currentPage&&this.hasPage(t)||this.page.next(this.pagination.currentPage=t)},e.prototype.nextPage=function(){this.currentPage!==this.pagination.lastPage&&this.setPage(this.pagination.currentPage+1)},e.prototype.prevPage=function(){this.pagination.currentPage>1&&this.setPage(this.pagination.currentPage-1)},e.prototype.setLastPage=function(){this.setPage(this.pagination.lastPage)},e.prototype.setFirstPage=function(){this.setPage(1)},e.prototype.hasPage=function(t){return this.pages.has(t)},e.prototype.getPage=function(t){var e=this,n=this.pagination.currentPage;return this.hasPage(n)?this.selectPage(n):(this.setLoading(!0),Ot(t()).pipe(oe(function(t){return n=t.currentPage,De(function(){e.setLoading(!1),e.update(t)}),e.selectPage(n)})))},e.prototype.getQuery=function(){return this.query},e.prototype.refreshCurrentPage=function(){!1===on(this.currentPage)&&(this.clearPage(this.currentPage),this.setPage(this.currentPage))},e.prototype.getFrom=function(){return this.isFirst?1:(this.currentPage-1)*this.pagination.perPage+1},e.prototype.getTo=function(){return this.isLast?this.pagination.total:this.currentPage*this.pagination.perPage},e.prototype.selectPage=function(t){var e,n=this;return this.query.selectAll({asObject:!0}).pipe((e=1,function(t){return 0===e?Y():t.lift(new Gt(e))}),at(function(e){var r=i({},n.pagination,{data:n.pages.get(t).ids.map(function(t){return e[t]})}),o=n.config,s=o.range,u=o.pagesControls;return isNaN(n.pagination.total)&&(1===r.lastPage?r.total=r.data?r.data.length:0:r.total=r.perPage*r.lastPage,n.pagination.total=r.total),s&&(r.from=n.getFrom(),r.to=n.getTo()),u&&(r.pageControls=function(t,e){for(var n=Math.ceil(t/e),r=[],i=0;i<n;i++)r.push(i+1);return r}(n.pagination.total,n.pagination.perPage)),r}))},o([Oe("@Pagination - New Page"),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],e.prototype,"update",null),e}(Rn);t.PaginatorPlugin=Mn;var Bn=Mn;t.Paginator=Bn;var qn=function(t){function e(e,n,r){void 0===r&&(r={});var o=t.call(this,e)||this;return o.query=e,o.factoryFnOrPath=n,o.params=r,o.params=i({debounceTime:300,formKey:"akitaForm",emitEvent:!1,arrControlFactory:function(t){return o.builder.control(t)}},r),o.isRootKeys=!1===Be(n),o.isKeyBased=wn(n)||o.isRootKeys,o}return r(e,t),e.prototype.setForm=function(t,e){return this.form=t,this.builder=e,this.activate(),this},e.prototype.reset=function(t){var e,n,r=this;n=t||(this.isKeyBased?this.initialValue:this.factoryFnOrPath()),this.isKeyBased&&Object.keys(this.initialValue).forEach(function(t){var e=r.initialValue[t];if(Array.isArray(e)&&r.builder){var n=r.form.controls[t];r.cleanArray(n),e.forEach(function(e,n){r.form.get(t).insert(n,r.params.arrControlFactory(e))})}}),this.form.patchValue(n,{emitEvent:this.params.emitEvent});var i=this.isKeyBased?jn(this.getQuery().getValue(),this.getStore().storeName+"."+this.factoryFnOrPath,n):((e={})[this.params.formKey]=n,e);this.updateStore(i)},e.prototype.cleanArray=function(t){for(;0!==t.length;)t.removeAt(0)},e.prototype.resolveInitialValue=function(t,e){var n=this;if(t)return Object.keys(t).reduce(function(t,r){var i=e[r];if(Array.isArray(i)&&n.builder){var o=n.params.arrControlFactory;n.cleanArray(n.form.get(r)),i.forEach(function(t,e){n.form.get(r).insert(e,o(t))})}return t[r]=e[r],t},{})},e.prototype.activate=function(){var t,e,n,r,o=this;if(this.isKeyBased)if(this.isRootKeys)this.initialValue=this.resolveInitialValue(this.form.value,this.getQuery().getValue()),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent});else{e=this.getStore().storeName+"."+this.factoryFnOrPath;var s=Nn(this.getQuery().getValue(),e);this.initialValue=this.resolveInitialValue(s,s),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent})}else{this.getQuery().getValue()[this.params.formKey]||(Ee("@PersistNgFormPlugin activate"),this.updateStore(((t={})[this.params.formKey]=this.factoryFnOrPath(),t)));var u=this.getQuery().getValue()[this.params.formKey];this.form.patchValue(u)}this.formChanges=this.form.valueChanges.pipe((n=this.params.debounceTime,void 0===r&&(r=rt),function(t){return t.lift(new Ft(n,r))})).subscribe(function(t){var n;Ee("@PersistForm - Update"),n=o.isKeyBased?o.isRootKeys?function(e){return i({},e,t)}:function(n){return jn(n,e,t)}:function(){var e;return(e={})[o.params.formKey]=t,e},o.updateStore(n(o.getQuery().getValue()))})},e.prototype.destroy=function(){this.formChanges&&this.formChanges.unsubscribe(),this.form=null,this.builder=null},e}(Rn);function $n(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}t.PersistNgFormPlugin=qn;var Qn=[];var Yn=function(){function t(t,e){this.query=t,this.entityIds=e,this.entities=new Map}return t.prototype.getEntity=function(t){return this.entities.get(t)},t.prototype.hasEntity=function(t){return this.entities.has(t)},t.prototype.removeEntity=function(t){return this.destroy(t),this.entities.delete(t)},t.prototype.createEntity=function(t,e){return this.entities.set(t,e)},t.prototype.getIds=function(){return yn(this.entityIds)?this.query.getValue().ids:cn(this.entityIds)},t.prototype.resolvedIds=function(t){return yn(t)?this.getIds():cn(t)},t.prototype.rebase=function(t,e){var n=this;if(void 0===e&&(e={}),Be(t))if(yn(this.entityIds)){for(var r=0,i=t.length;r<i;r++){var o=t[r];if(!1===this.hasEntity(o)){$e(e.beforeAdd)&&e.beforeAdd(o);var s=this.instantiatePlugin(o);this.entities.set(o,s),$e(e.afterAdd)&&e.afterAdd(s)}}this.entities.forEach(function(r,i){-1===t.indexOf(i)&&($e(e.beforeRemove)&&e.beforeRemove(r),n.removeEntity(i))})}else{var u=cn(this.entityIds);for(r=0,i=u.length;r<i;r++){o=u[r];if(t.indexOf(o)>-1&&!1===this.hasEntity(o)){$e(e.beforeAdd)&&e.beforeAdd(o);s=this.instantiatePlugin(o);this.entities.set(o,s),$e(e.afterAdd)&&e.afterAdd(s)}else this.entities.forEach(function(r,i){-1===t.indexOf(i)&&!0===n.hasEntity(i)&&($e(e.beforeRemove)&&e.beforeRemove(r),n.removeEntity(i))})}}else this.getIds().forEach(function(t){n.hasEntity(t)||n.createEntity(t,n.instantiatePlugin(t))})},t.prototype.selectIds=function(){return this.query.select(function(t){return t.ids})},t.prototype.activate=function(t){this.rebase(t)},t.prototype.forEachId=function(t,e){for(var n=this.resolvedIds(t),r=0,i=n.length;r<i;r++){var o=n[r];this.hasEntity(o)&&e(this.getEntity(o))}},t}();t.EntityCollectionPlugin=Yn;var Ln=function(t){function e(e,n,r){void 0===n&&(n={});var i=t.call(this,e,{resetFn:function(){return i.clear()}})||this;return i.query=e,i.params=n,i._entityId=r,i.skip=!1,i.history={past:[],present:null,future:[]},i.skipUpdate=!1,n.maxAge=Be(n.maxAge)?n.maxAge:10,n.comparator=n.comparator||function(t,e){return!0},i.activate(),i}return r(e,t),Object.defineProperty(e.prototype,"hasPast",{get:function(){return this.history.past.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasFuture",{get:function(){return this.history.future.length>0},enumerable:!0,configurable:!0}),e.prototype.activate=function(){var t=this;this.history.present=this.getSource(this._entityId),this.subscription=this.selectSource(this._entityId).pipe(function(t){return t.lift(new te)}).subscribe(function(e){var n=a(e,2),r=n[0],i=n[1];if(t.skip)t.skip=!1;else{var o=t.params.comparator(r,i);!t.skipUpdate&&o&&(t.history.past.length===t.params.maxAge&&(t.history.past=t.history.past.slice(1)),t.history.past=c(t.history.past,[r]),t.history.present=i)}})},e.prototype.undo=function(){if(this.history.past.length>0){var t=this.history,e=t.past,n=t.present,r=e[e.length-1];this.history.past=e.slice(0,e.length-1),this.history.present=r,this.history.future=c([n],this.history.future),this.update()}},e.prototype.redo=function(){if(this.history.future.length>0){var t=this.history,e=t.past,n=t.present,r=this.history.future[0],i=this.history.future.slice(1);this.history.past=c(e,[n]),this.history.present=r,this.history.future=i,this.update("Redo")}},e.prototype.jumpToPast=function(t){if(!(t<0||t>=this.history.past.length)){var e=this.history,n=e.past,r=e.future,i=n.slice(0,t),o=c(n.slice(t+1),r),s=n[t];this.history.past=i,this.history.present=s,this.history.future=o,this.update()}},e.prototype.jumpToFuture=function(t){if(!(t<0||t>=this.history.future.length)){var e=this.history,n=e.past,r=e.future,i=c(n,r.slice(0,t)),o=r[t],s=r.slice(t+1);this.history.past=i,this.history.present=o,this.history.future=s,this.update("Redo")}},e.prototype.clear=function(t){this.history=$e(t)?t(this.history):{past:[],present:null,future:[]}},e.prototype.destroy=function(t){void 0===t&&(t=!1),t&&this.clear(),this.subscription.unsubscribe()},e.prototype.ignoreNext=function(){this.skip=!0},e.prototype.update=function(t){void 0===t&&(t="Undo"),this.skipUpdate=!0,Ee("@StateHistory - "+t),this.updateStore(this.history.present,this._entityId),this.skipUpdate=!1},e}(Rn);t.StateHistoryPlugin=Ln;var zn=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,e,n.entityIds)||this;return r.query=e,r.params=n,n.maxAge=Be(n.maxAge)?n.maxAge:10,r.activate(),r.selectIds().pipe(ne(1)).subscribe(function(t){return r.activate(t)}),r}return r(e,t),e.prototype.redo=function(t){this.forEachId(t,function(t){return t.redo()})},e.prototype.undo=function(t){this.forEachId(t,function(t){return t.undo()})},e.prototype.hasPast=function(t){if(this.hasEntity(t))return this.getEntity(t).hasPast},e.prototype.hasFuture=function(t){if(this.hasEntity(t))return this.getEntity(t).hasFuture},e.prototype.jumpToFuture=function(t,e){this.forEachId(t,function(t){return t.jumpToFuture(e)})},e.prototype.jumpToPast=function(t,e){this.forEachId(t,function(t){return t.jumpToPast(e)})},e.prototype.clear=function(t){this.forEachId(t,function(t){return t.clear()})},e.prototype.destroy=function(t,e){void 0===e&&(e=!1),this.forEachId(t,function(t){return t.destroy(e)})},e.prototype.ignoreNext=function(t){this.forEachId(t,function(t){return t.ignoreNext()})},e.prototype.instantiatePlugin=function(t){return new Ln(this.query,this.params,t)},e}(Yn);t.EntityStateHistoryPlugin=zn;var Wn={comparator:function(t,e){return JSON.stringify(t)!==JSON.stringify(e)}};function Jn(t,e){return e.split(".").reduce(function(t,e){return t&&"undefined"!==t[e]?t[e]:void 0},t)}t.dirtyCheckDefaultParams=Wn;var Xn=function(t){function e(e,n,r){var o=t.call(this,e)||this;if(o.query=e,o.params=n,o._entityId=r,o.dirty=new R(!1),o.active=!1,o._reset=new k,o.isDirty$=o.dirty.asObservable().pipe($t()),o.reset$=o._reset.asObservable(),o.params=i({},Wn,n),o.params.watchProperty){var s=cn(o.params.watchProperty);e instanceof In&&s.includes("entities")&&!s.includes("ids")&&s.push("ids"),o.params.watchProperty=s}return o}return r(e,t),e.prototype.reset=function(t){void 0===t&&(t={});var e=this.head;$e(t.updateFn)&&(e=this.isEntityBased(this._entityId)?t.updateFn(this.head,this.getQuery().getEntity(this._entityId)):t.updateFn(this.head,this.getQuery().getValue())),Ee("@DirtyCheck - Revert"),this.updateStore(e,this._entityId),this._reset.next()},e.prototype.setHead=function(){return this.active?this.head=this._getHead():(this.activate(),this.active=!0),this.updateDirtiness(!1),this},e.prototype.isDirty=function(){return Be(this.dirty.value)},e.prototype.hasHead=function(){return Be(this.getHead())},e.prototype.destroy=function(){this.head=null,this.subscription&&this.subscription.unsubscribe(),this._reset&&this._reset.complete()},e.prototype.isPathDirty=function(t){var e=this.getHead(),n=Jn(this.getQuery().getValue(),t),r=Jn(e,t);return this.params.comparator(n,r)},e.prototype.getHead=function(){return this.head},e.prototype.activate=function(){var t=this;this.head=this._getHead();var e=this.params.watchProperty?this.params.watchProperty.map(function(e){return t.query.select(function(t){return t[e]}).pipe(at(function(t){return{val:t,__akitaKey:e}}))}):[this.selectSource(this._entityId)];this.subscription=Et.apply(void 0,c(e)).pipe(ne(1)).subscribe(function(e){if(!yn(t.head)){var n=e.some(function(e){var n=e.__akitaKey?t.head[e.__akitaKey]:t.head,r=e.__akitaKey?e.val:e;return t.params.comparator(n,r)});t.updateDirtiness(n)}})},e.prototype.updateDirtiness=function(t){this.dirty.next(t)},e.prototype._getHead=function(){var t=this.getSource(this._entityId);return this.params.watchProperty&&(t=this.getWatchedValues(t)),t},e.prototype.getWatchedValues=function(t){return this.params.watchProperty.reduce(function(e,n){return e[n]=t[n],e},{})},e}(Rn);t.DirtyCheckPlugin=Xn;var Gn=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,e,n.entityIds)||this;return r.query=e,r.params=n,r._someDirty=new k,r.someDirty$=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,r=null,i=t[t.length-1];return L(i)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof i&&(n=t.pop()),null===r&&1===t.length&&t[0]instanceof O?t[0]:Tt(n)(W(t,r))}(r.query.select(function(t){return t.entities}),r._someDirty.asObservable()).pipe(Vt(0),at(function(){return r.checkSomeDirty()})),r.params=i({},Wn,n),r.activate(),r.selectIds().pipe(ne(1)).subscribe(function(e){t.prototype.rebase.call(r,e,{afterAdd:function(t){return t.setHead()}})}),r}return r(e,t),e.prototype.setHead=function(t){if(this.params.entityIds&&t){var e=cn(t);if(!1===cn(this.params.entityIds).some(function(t){return e.indexOf(t)>-1}))return this}return this.forEachId(t,function(t){return t.setHead()}),this._someDirty.next(),this},e.prototype.hasHead=function(t){return!!this.entities.has(t)&&this.getEntity(t).hasHead()},e.prototype.reset=function(t,e){void 0===e&&(e={}),this.forEachId(t,function(t){return t.reset(e)})},e.prototype.isDirty=function(t,e){if(void 0===e&&(e=!0),this.entities.has(t)){var n=this.getEntity(t);return e?n.isDirty$:n.isDirty()}return!1},e.prototype.someDirty=function(){return this.checkSomeDirty()},e.prototype.isPathDirty=function(t,e){if(this.entities.has(t)){var n=this.getEntity(t).getHead(),r=Jn(this.query.getEntity(t),e),i=Jn(n,e);return this.params.comparator(r,i)}return null},e.prototype.destroy=function(t){this.forEachId(t,function(t){return t.destroy()}),t||this._someDirty.complete()},e.prototype.instantiatePlugin=function(t){return new Xn(this.query,this.params,t)},e.prototype.checkSomeDirty=function(){var t,e,n=this.resolvedIds();try{for(var r=u(n),i=r.next();!i.done;i=r.next()){var o=i.value;if(this.getEntity(o).isDirty())return!0}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return!1},e}(Yn);t.EntityDirtyCheckPlugin=Gn;var Zn={Update:0,AddEntities:1,SetEntities:2,UpdateEntities:3,RemoveEntities:4};function tr(t,e,n){var r,i,o,s,a=[];if($e(e))try{for(var c=u(t),h=c.next();!h.done;h=c.next()){!0===e(d=h.value)&&a.push(d)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else{var f=cn(e).reduce(function(t,e){return t.add(e)},new Set);try{for(var p=u(t),l=p.next();!l.done;l=p.next()){var d=l.value;f.has(d[n])&&a.push(d)}}catch(t){o={error:t}}finally{try{l&&!l.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}}return a}function er(){return $t(function(t,e){return t===e||!1!==ae(t)&&!1!==ae(e)&&(!(!ce(t)||!ce(e))||!nr(e,t)&&!1===nr(t,e))})}function nr(t,e){return e.some(function(e){return void 0===t.find(function(t){return t===e})})}t.StoreActions=Zn,Zn[Zn.Update]="Update",Zn[Zn.AddEntities]="AddEntities",Zn[Zn.SetEntities]="SetEntities",Zn[Zn.UpdateEntities]="UpdateEntities",Zn[Zn.RemoveEntities]="RemoveEntities"});