<page-details>
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-2">
        <breadcrumb></breadcrumb>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" onclick="{toggleActive}">
            <i class="fas fa-star fa-sm {state.item.isActive ? 'text-white-50' : ''}"></i> Acitive</a>
    </div>

    <!-- Content Row -->
    <div class="row">

        <!-- Content Column -->
        <div class="col-lg-12 mb-4">
            <!-- Project Card Example -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">{state.item.name}</h6>
                </div>
                <div class="card-body">
                    Age: {state.item.age} years old<br/>
                    Gender: {state.item.gender}<br/>
                    Email: {state.item.email}<br/>
                    Phone: {state.item.phone}<br/>
                    Address: {state.item.address}<br/>
                    Balance: {state.item.balance}<br/>
                    Friends: 
                    <span each="{ (friend,index) in state.item.friends}">
                        <a href="/#/list/{friend.id}" onclick="{()=>service.pushBreadcrumb(friend.name,friend.id)}" class="ml-1">{friend.name}</a>
                        <span if="{state.item.friends.length-1 != index}">,</span>
                    </span>
                    <br/>
                    <hr/>
                    <span each="tag in state.item.tags" class="badge badge-primary mr-2">{tag}</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        export default {
            state: {
                item:{},
                subParam:null,
                subList:null
                
            },
            onMounted(props,state){
                this.state.subList = this.query.select('list').subscribe(list=> {
                    console.log('list changed')
                    const params = this.store.store.getValue().params;
                    if (list && params){
                        const id = parseInt(params.id);
                        const item = list.find(item=>item.id === id);
                        //console.log(item);
                        this.update({item:item});
                    }
                });
                this.state.subParam = this.query.select('params').pipe(item=>{
                    console.log('in pipe',item,this,this.constructor);
                    return item;
                }).subscribe(params=>{
                    if (params){
                        this.service.getDetails(parseInt(params.id));
                    }
                });
            },
            toggleActive(){
                console.log(this.state);
                this.service.updateActive(this.state.item.id, !this.state.item.isActive);
            },
            onUnmounted(props,state){
                if (this.state.subList) {
                    console.log('cleaning up....list');
                    this.state.subList.unsubscribe();
                }
                if (this.state.subParam) {
                    console.log('cleaning up....param');
                    this.state.subParam.unsubscribe();
                }

            }

        }
    </script>
    <style>
    </style>
</page-details>